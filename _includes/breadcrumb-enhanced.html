<!-- Enhanced Breadcrumb with Structured Data -->

{% assign page_url = page.url | remove: 'index.html' %}
{% assign url_parts = page_url | split: '/' | compact %}

<!-- Visual Breadcrumb Navigation -->
<nav class="breadcrumb-navigation" aria-label="breadcrumb">
  <ol class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
    <!-- Home -->
    <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
      <a href="{{ site.url }}/" itemprop="item">
        <span itemprop="name">首頁</span>
      </a>
      <meta itemprop="position" content="1" />
    </li>
    
    {% if page.collection == "rooms" %}
      <!-- Rooms Category -->
      <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href="{{ site.url }}/landing.html" itemprop="item">
          <span itemprop="name">住宿選擇</span>
        </a>
        <meta itemprop="position" content="2" />
      </li>
      <!-- Current Room -->
      <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span itemprop="item">
          <span itemprop="name">{{ page.title }}</span>
        </span>
        <meta itemprop="position" content="3" />
      </li>
      
    {% elsif page.collection == "infos" %}
      <!-- Info Page -->
      <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span itemprop="item">
          <span itemprop="name">{{ page.title }}</span>
        </span>
        <meta itemprop="position" content="2" />
      </li>
      
    {% elsif page.collection == "announcements" %}
      <!-- Announcements Category -->
      <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href="{{ site.url }}/announcements/" itemprop="item">
          <span itemprop="name">最新公告</span>
        </a>
        <meta itemprop="position" content="2" />
      </li>
      <!-- Current Announcement -->
      <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span itemprop="item">
          <span itemprop="name">{{ page.title }}</span>
        </span>
        <meta itemprop="position" content="3" />
      </li>
      
    {% elsif page.layout == "post" %}
      <!-- Blog Category -->
      <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href="{{ site.url }}/blog/" itemprop="item">
          <span itemprop="name">部落格</span>
        </a>
        <meta itemprop="position" content="2" />
      </li>
      {% if page.categories %}
        <!-- Post Category -->
        <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="{{ site.url }}/category/{{ page.categories[0] | slugify }}/" itemprop="item">
            <span itemprop="name">{{ page.categories[0] }}</span>
          </a>
          <meta itemprop="position" content="3" />
        </li>
        <!-- Current Post -->
        <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <span itemprop="item">
            <span itemprop="name">{{ page.title }}</span>
          </span>
          <meta itemprop="position" content="4" />
        </li>
      {% else %}
        <!-- Current Post (no category) -->
        <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <span itemprop="item">
            <span itemprop="name">{{ page.title }}</span>
          </span>
          <meta itemprop="position" content="3" />
        </li>
      {% endif %}
      
    {% else %}
      <!-- Generic Page -->
      {% assign position = 2 %}
      {% for part in url_parts %}
        {% if forloop.last %}
          <li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <span itemprop="item">
              <span itemprop="name">{{ page.title | default: part | replace: '-', ' ' | capitalize }}</span>
            </span>
            <meta itemprop="position" content="{{ position }}" />
          </li>
        {% else %}
          <li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
            <a href="{{ site.url }}/{% for i in (1..forloop.index) %}{{ url_parts[i-1] }}/{% endfor %}" itemprop="item">
              <span itemprop="name">{{ part | replace: '-', ' ' | capitalize }}</span>
            </a>
            <meta itemprop="position" content="{{ position }}" />
          </li>
          {% assign position = position | plus: 1 %}
        {% endif %}
      {% endfor %}
    {% endif %}
  </ol>
</nav>

<!-- Breadcrumb Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "@id": "{{ site.url }}{{ page.url }}#breadcrumb",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "首頁",
      "item": "{{ site.url }}/"
    }
    {% if page.collection == "rooms" %}
    ,{
      "@type": "ListItem", 
      "position": 2,
      "name": "住宿選擇",
      "item": "{{ site.url }}/landing.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page.title }}",
      "item": "{{ site.url }}{{ page.url }}"
    }
    {% elsif page.collection == "infos" %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "{{ page.title }}",
      "item": "{{ site.url }}{{ page.url }}"
    }
    {% elsif page.collection == "announcements" %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "最新公告",
      "item": "{{ site.url }}/announcements/"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page.title }}",
      "item": "{{ site.url }}{{ page.url }}"
    }
    {% elsif page.layout == "post" %}
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "部落格",
      "item": "{{ site.url }}/blog/"
    }
    {% if page.categories %}
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page.categories[0] }}",
      "item": "{{ site.url }}/category/{{ page.categories[0] | slugify }}/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "{{ page.title }}",
      "item": "{{ site.url }}{{ page.url }}"
    }
    {% else %}
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": "{{ page.title }}",
      "item": "{{ site.url }}{{ page.url }}"
    }
    {% endif %}
    {% else %}
    {% assign position = 2 %}
    {% for part in url_parts %}
    ,{
      "@type": "ListItem",
      "position": {{ position }},
      "name": "{% if forloop.last %}{{ page.title | default: part | replace: '-', ' ' | capitalize }}{% else %}{{ part | replace: '-', ' ' | capitalize }}{% endif %}",
      "item": "{{ site.url }}/{% for i in (1..forloop.index) %}{{ url_parts[i-1] }}{% unless forloop.last %}/{% endunless %}{% endfor %}"
    }
    {% assign position = position | plus: 1 %}
    {% endfor %}
    {% endif %}
  ]
}
</script>

<!-- Breadcrumb Styles -->
<style>
.breadcrumb-navigation {
  margin: 1em 0;
  padding: 0.5em 1em;
  background-color: #f8f9fa;
  border-radius: 0.25rem;
}

.breadcrumb {
  display: flex;
  flex-wrap: wrap;
  padding: 0;
  margin: 0;
  list-style: none;
  background-color: transparent;
}

.breadcrumb-item {
  display: flex;
  align-items: center;
}

.breadcrumb-item + .breadcrumb-item::before {
  display: inline-block;
  padding-right: 0.5rem;
  padding-left: 0.5rem;
  color: #6c757d;
  content: "›";
}

.breadcrumb-item a {
  color: #007bff;
  text-decoration: none;
  transition: color 0.15s ease-in-out;
}

.breadcrumb-item a:hover {
  color: #0056b3;
  text-decoration: underline;
}

.breadcrumb-item.active {
  color: #6c757d;
}

/* Mobile Responsive */
@media (max-width: 576px) {
  .breadcrumb-navigation {
    padding: 0.25em 0.5em;
    font-size: 0.875rem;
  }
  
  .breadcrumb-item + .breadcrumb-item::before {
    padding-right: 0.25rem;
    padding-left: 0.25rem;
  }
}

/* Print Styles */
@media print {
  .breadcrumb-navigation {
    display: none;
  }
}

/* Accessibility */
.breadcrumb-item a:focus {
  outline: 2px solid #007bff;
  outline-offset: 2px;
}

/* Dark Mode Support */
@media (prefers-color-scheme: dark) {
  .breadcrumb-navigation {
    background-color: #343a40;
  }
  
  .breadcrumb-item a {
    color: #6cb2eb;
  }
  
  .breadcrumb-item a:hover {
    color: #a8d8f0;
  }
  
  .breadcrumb-item.active,
  .breadcrumb-item + .breadcrumb-item::before {
    color: #adb5bd;
  }
}
</style>