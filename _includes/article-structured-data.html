<!-- Article and BlogPosting Structured Data -->

{% if page.layout == "post" or page.collection == "announcements" %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": {% if page.type == "announcement" %}"NewsArticle"{% else %}"BlogPosting"{% endif %},
  "@id": "{{ site.url }}{{ page.url }}#article",
  "headline": "{{ page.title | strip_html | strip_newlines | escape }}",
  "alternativeHeadline": "{{ page.subtitle | default: page.excerpt | strip_html | strip_newlines | truncate: 110 | escape }}",
  "description": "{{ page.description | default: page.excerpt | strip_html | strip_newlines | truncate: 160 | escape }}",
  "image": {% if page.image %}[
    {
      "@type": "ImageObject",
      "url": "{{ site.url }}{{ page.image }}",
      "width": 1200,
      "height": 630
    }
  ]{% else %}[
    {
      "@type": "ImageObject",
      "url": "{{ site.url }}/assets/images/banner.jpg",
      "width": 1200,
      "height": 630
    }
  ]{% endif %},
  "datePublished": "{{ page.date | date_to_xmlschema }}",
  "dateModified": "{% if page.modified_date %}{{ page.modified_date | date_to_xmlschema }}{% else %}{{ page.date | date_to_xmlschema }}{% endif %}",
  "author": {
    "@type": "Organization",
    "@id": "{{ site.url }}/#organization",
    "name": "{{ site.title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.url }}{{ site.logo }}"
    }
  },
  "publisher": {
    "@type": "Organization",
    "@id": "{{ site.url }}/#organization",
    "name": "{{ site.title }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ site.url }}{{ site.logo }}",
      "width": 512,
      "height": 512
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ site.url }}{{ page.url }}"
  },
  {% if page.keywords %}
  "keywords": "{{ page.keywords }}",
  {% endif %}
  "articleSection": "{% if page.categories %}{{ page.categories | join: ', ' }}{% else %}公告{% endif %}",
  "inLanguage": "zh-TW",
  "potentialAction": {
    "@type": "ReadAction",
    "target": ["{{ site.url }}{{ page.url }}"]
  },
  "wordCount": "{{ page.content | strip_html | number_of_words }}",
  {% if page.tags %}
  "articleBody": "{{ page.content | strip_html | strip_newlines | escape }}",
  "about": [
    {% for tag in page.tags %}
    {
      "@type": "Thing",
      "name": "{{ tag }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ],
  {% endif %}
  "isAccessibleForFree": true,
  "isPartOf": {
    "@type": "Blog",
    "name": "{{ site.title }} 部落格",
    "url": "{{ site.url }}/blog/"
  }
}
</script>

<!-- Article Speakable for Voice Assistants -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebPage",
  "name": "{{ page.title }}",
  "speakable": {
    "@type": "SpeakableSpecification",
    "cssSelector": [
      ".post-title",
      ".post-content p:first-of-type",
      ".post-summary"
    ]
  }
}
</script>
{% endif %}

<!-- Collection Page Structured Data -->
{% if page.url == "/landing.html" or page.layout == "allposts" %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ page.title | default: '所有文章' }}",
  "description": "{{ page.description | default: site.description }}",
  "url": "{{ site.url }}{{ page.url }}",
  "isPartOf": {
    "@type": "WebSite",
    "@id": "{{ site.url }}/#website"
  },
  "about": {
    "@type": "Thing",
    "name": "密式旅行住宿與資訊"
  },
  "mainEntity": {
    "@type": "ItemList",
    "itemListElement": [
      {% assign items = site.rooms | concat: site.posts | sort: 'date' | reverse %}
      {% for item in items limit:10 %}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "item": {
          "@type": {% if item.collection == 'rooms' %}Product{% else %}BlogPosting{% endif %}",
          "url": "{{ site.url }}{{ item.url }}",
          "name": "{{ item.title }}",
          "description": "{{ item.description | default: item.excerpt | strip_html | truncate: 160 }}"
        }
      }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
}
</script>
{% endif %}

<!-- LiveBlogPosting for Real-time Updates -->
{% if page.live_blog %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "LiveBlogPosting",
  "@id": "{{ site.url }}{{ page.url }}#liveblog",
  "headline": "{{ page.title }}",
  "coverageStartTime": "{{ page.date | date_to_xmlschema }}",
  "coverageEndTime": "{{ page.end_date | date_to_xmlschema }}",
  "liveBlogUpdate": [
    {% for update in page.updates %}
    {
      "@type": "BlogPosting",
      "headline": "{{ update.title }}",
      "datePublished": "{{ update.date | date_to_xmlschema }}",
      "articleBody": "{{ update.content | strip_html | escape }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>
{% endif %}